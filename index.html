<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dictation Master</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Roboto+Mono:wght@500&display=swap');

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f0f4f8;
            height: 100vh;
            overflow: hidden;
            touch-action: manipulation;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mono {
            font-family: 'Roboto Mono', monospace;
        }

        #sentenceDisplay {
            user-select: none;
            -webkit-user-select: none;
        }

        .word-wrapper {
            display: inline-flex;
            white-space: nowrap;
            margin: 0 0.85rem;
        }

        .char-slot {
            display: inline-block;
            width: 1.2rem;
            text-align: center;
            margin: 0 1px;
            position: relative;
        }

        .char-masked {
            color: transparent;
            border-bottom: 2px solid #cbd5e1;
        }

        .cursor {
            border-bottom: 3px solid #3b82f6 !important;
            animation: blink 0.8s infinite;
        }

        @keyframes blink {
            0%, 100% { border-color: #3b82f6; }
            50% { border-color: transparent; }
        }

        .char-correct { color: #10b981; border-bottom: 2px solid transparent; }
        .char-hint { color: #ef4444; border-bottom: 2px solid transparent; }
        .char-static { border-bottom: 2px solid transparent; }

        .correct-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .correct-circle {
            width: 200px;
            height: 200px;
            border: 15px solid #ef4444;
            border-radius: 50%;
            transform: scale(0.5);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .show-overlay { opacity: 1; }
        .show-overlay .correct-circle { transform: scale(1.2); }

        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .illustration-container svg {
            width: 120px;
            height: 120px;
            margin-bottom: 1rem;
        }

        #hiddenInput {
            position: absolute;
            left: -9999px;
            top: 0;
            width: 1px;
            height: 1px;
            opacity: 0;
            font-size: 16px; 
        }

        button {
            touch-action: none;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        #imeWarning {
            position: absolute;
            top: 1rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: #ef4444;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 12px;
            font-weight: bold;
            z-index: 50;
            display: none;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }
    </style>
</head>
<body>

    <div id="app" class="w-full max-w-2xl bg-white shadow-2xl rounded-3xl overflow-hidden relative mx-2">
        
        <div id="imeWarning">âš ï¸ è‹±æ•°å…¥åŠ›ã«åˆ‡ã‚Šæ›¿ãˆã¦ãã ã•ã„</div>

        <div id="successOverlay" class="correct-overlay">
            <div class="correct-circle"></div>
        </div>

        <input type="password" id="hiddenInput" autocomplete="off" autocapitalize="off" spellcheck="false" inputmode="email">

        <!-- 1. ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ -->
        <div id="screenStart" class="p-8 md:p-12 text-center fade-in">
            <h1 class="text-3xl md:text-4xl font-bold text-blue-600 mb-4">Dictation Master</h1>
            <p class="text-gray-600 mb-10">è´ãå–ã£ã¦ã€æ‰“ã¡è¾¼ã‚ã€‚<br>ã‚ãªãŸã®ä»Šã®è‹±èªåŠ›ã‚’è¨ºæ–­ã—ã¾ã™ã€‚</p>
            
            <div class="flex flex-col gap-4 max-w-xs mx-auto">
                <button type="button" onclick="game.start('junior')" class="bg-green-500 hover:bg-green-600 text-white text-xl font-bold py-4 px-8 rounded-2xl transition transform active:scale-95 shadow-md">
                    ä¸­å­¦ç”Ÿãƒ¬ãƒ™ãƒ«
                </button>
                <button type="button" onclick="game.start('senior')" class="bg-orange-500 hover:bg-orange-600 text-white text-xl font-bold py-4 px-8 rounded-2xl transition transform active:scale-95 shadow-md">
                    é«˜æ ¡ç”Ÿãƒ¬ãƒ™ãƒ«
                </button>
                <button type="button" onclick="game.start('toeic')" class="bg-indigo-600 hover:bg-indigo-700 text-white text-xl font-bold py-4 px-8 rounded-2xl transition transform active:scale-95 shadow-md">
                    TOEICå¯¾ç­–
                </button>
            </div>
        </div>

        <!-- 2. ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ¬ã‚¤ç”»é¢ -->
        <div id="screenPlay" class="hidden p-6 md:p-8 fade-in flex flex-col h-[550px]" onclick="game.focusInput()">
            <div class="flex justify-between items-center mb-6">
                <div class="flex flex-col">
                    <div id="levelBadge" class="text-[10px] font-bold px-2 py-0.5 rounded-full w-fit mb-1 uppercase tracking-tighter">LEVEL</div>
                    <div class="text-sm font-bold text-gray-400 uppercase tracking-widest">
                        Progress: <span id="progressText" class="text-blue-600 text-lg">1 / 5</span>
                    </div>
                </div>
                <button type="button" onclick="event.stopPropagation(); audioManager.replaySentence()" class="flex items-center gap-2 text-blue-500 hover:text-blue-700 font-bold transition p-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                    </svg>
                    è´ã
                    <span class="text-[10px] font-bold text-blue-400 border border-blue-200 rounded px-1 py-0.5 leading-none">SPACE</span>
                </button>
            </div>

            <div class="bg-slate-50 border-2 border-slate-100 rounded-2xl p-4 md:p-8 mb-4 text-center flex-grow flex flex-col items-center justify-center gap-6 overflow-hidden">
                <div id="sentenceDisplay" class="text-xl md:text-2xl mono leading-relaxed tracking-wider flex flex-wrap justify-center gap-y-4">
                </div>
                <div id="translationDisplay" class="opacity-0 transform translate-y-2 text-base md:text-lg font-bold text-blue-600 border-t border-slate-200 pt-6 w-full transition-all duration-300">
                </div>
            </div>

            <div class="flex flex-col items-center gap-4 mt-auto">
                <button type="button" id="hintBtn" onclick="event.stopPropagation(); game.useHint()" class="bg-orange-100 hover:bg-orange-200 text-orange-600 font-bold py-3 px-8 rounded-xl transition flex items-center gap-2 active:scale-95">
                    <span>ğŸ’¡ 1æ–‡å­—ãƒ’ãƒ³ãƒˆ</span>
                </button>
                <p class="text-[10px] text-gray-400 italic">ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‹ã‚‰ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
            </div>
        </div>

        <!-- 3. ãƒªã‚¶ãƒ«ãƒˆç”»é¢ -->
        <div id="screenResult" class="hidden p-6 md:p-8 text-center fade-in">
            <h2 class="text-2xl font-bold text-gray-800 mb-2">è¨ºæ–­çµæœ</h2>
            <p class="text-xs text-gray-400 mb-4 uppercase tracking-widest">English Proficiency Report</p>
            
            <div id="rankContainer" class="mb-4 flex flex-col items-center justify-center min-h-[220px]">
                <div id="rankIllustration" class="illustration-container"></div>
                <div id="rankLabel" class="font-black tracking-tighter text-3xl md:text-4xl leading-tight">è¨ºæ–­ä¸­...</div>
                <div id="rankMessage" class="text-base md:text-lg font-bold text-gray-500 mt-4"></div>
            </div>

            <div class="bg-gray-50 rounded-2xl p-6 mb-8 inline-block w-full max-w-sm text-left border border-gray-100 shadow-inner">
                <div class="flex justify-between mb-2 text-sm">
                    <span class="text-gray-500 font-bold">Accuracy</span>
                    <span id="statMiss" class="font-bold text-gray-800">0 å›</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-gray-500 font-bold">Assistance</span>
                    <span id="statHint" class="font-bold text-gray-800">0 å›</span>
                </div>
                <hr class="my-3 border-gray-200">
                <div class="flex justify-between items-center">
                    <span class="font-bold text-gray-400 uppercase tracking-widest text-[10px]">Proficiency Score</span>
                    <span id="statScore" class="font-black text-blue-600 text-3xl">100</span>
                </div>
            </div>

            <div class="flex flex-col gap-3 items-center">
                <div class="flex gap-4 justify-center w-full">
                    <button type="button" onclick="game.start(game.currentLevel)" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-2xl transition shadow-lg flex-1 transform active:scale-95">
                        ãƒªãƒˆãƒ©ã‚¤
                    </button>
                    <button type="button" onclick="game.showReview()" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-8 rounded-2xl transition shadow-lg flex-1 transform active:scale-95">
                        å¾©ç¿’ã™ã‚‹
                    </button>
                </div>
                <button type="button" onclick="game.init()" class="text-gray-400 font-bold py-2 px-8 rounded-2xl transition hover:text-gray-600">
                    ãƒ¬ãƒ™ãƒ«é¸æŠã¸æˆ»ã‚‹
                </button>
            </div>
        </div>

        <!-- 4. æŒ¯ã‚Šè¿”ã‚Šç”»é¢ -->
        <div id="screenReview" class="hidden p-6 md:p-8 fade-in flex flex-col h-[550px]">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">ä»Šå›ã®èª²é¡Œ</h2>
            <div id="reviewList" class="flex-grow overflow-y-auto space-y-4 pr-2 mb-6 review-list">
            </div>
            <div class="flex flex-col gap-3 items-center mt-auto">
                <div class="flex gap-4 justify-center w-full">
                    <button type="button" onclick="game.start(game.currentLevel)" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-2xl transition shadow-lg flex-1 transform active:scale-95">
                        ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦
                    </button>
                    <button type="button" onclick="game.showScreen('screenResult')" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-3 px-8 rounded-2xl transition flex-1 transform active:scale-95">
                        çµæœã«æˆ»ã‚‹
                    </button>
                </div>
                <button type="button" onclick="game.init()" class="text-gray-400 font-bold py-2 px-8 rounded-2xl transition hover:text-gray-600">
                    ãƒ¬ãƒ™ãƒ«é¸æŠã¸
                </button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
